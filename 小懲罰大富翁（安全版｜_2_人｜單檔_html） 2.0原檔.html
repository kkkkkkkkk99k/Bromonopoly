<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>小懲罰大富翁</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121826; --muted:#96a0b5; --line:#1f2937;
      --blue:#38bdf8; --pink:#f472b6; --green:#34d399; --amber:#f59e0b; --red:#fb7185;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 800px at 70% 10%, #0f172a, #0b1220 60%, #08101b);color:#e5e7eb;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .wrap{display:grid;grid-template-columns:minmax(280px,420px) 1fr;gap:16px;padding:16px;min-height:100dvh}
    .card{background:var(--card);border:1px solid #263143;border-radius:16px;padding:14px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
    h1{font-size:40px;margin:0 0 8px}
    h2{font-size:24px;margin:14px 0 8px;color:#d1d5db}
    .grid{display:grid;gap:10px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .hint{font-size:18px;color:var(--muted)}

    /* Board */
    .board{display:grid;grid-template-columns:repeat(5,1fr);grid-template-rows:repeat(5,1fr);gap:4px;aspect-ratio:1/1;width:min(60vh,100%);margin:auto}
    .cell{border:1px solid var(--line);border-radius:10px;position:relative;display:flex;align-items:center;justify-content:center;color:#aab3c5;font-size:1上午 01:07 2025/8/142px}
    .cell .idx{position:absolute;left:20px;top:20px;opacity:.6;font-size:40px}
    .token{position:absolute;bottom:6px;right:6px;display:flex;gap:14px}
    .dot{width:40px;height:40px;border-radius:50%;border:8px solid rgba(0,0,0,.35);box-shadow:0 4px 8px rgba(0,0,0,.4)}
    .pA{background:var(--blue)}
    .pB{background:var(--pink)}

    /* Buttons */
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    button{all:unset;cursor:pointer;padding:10px 18px;border-radius:12px;border:1px solid #2a3849;font-weight:700;background:#182235}
    button:disabled{opacity:.45;cursor:not-allowed}
    .blue{background:linear-gradient(180deg,#40c7ff,#2aa0df);border:none;color:#05121b}
    .pink{background:linear-gradient(180deg,#ff89c3,#df66a4);border:none;color:#2a0e1f}
    .green{background:linear-gradient(180deg,#5fe3b2,#34d399);border:none;color:#062016}
    .ghost{background:#1b2437}

    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px dashed #2a3849;font-size:16px;color:#c9d3e7}
    .tag{font-size:11px;color:#9fb0c7;background:#1a2236;border:1px solid #2a3849;border-radius:999px;padding:4px 8px}

    /* Pools */
    .pool{display:grid;grid-template-columns:1fr;gap:6px;max-height:170px;overflow:auto;padding:8px;border:1px solid #223046;border-radius:12px;background:#101827}
    .pool label{display:flex;align-items:center;gap:8px;font-size:14px}
    .pool input{accent-color:#60a5fa}

    /* Log & task */
    .log{height:180px;overflow:auto;background:#0f1626;border:1px solid #223046;border-radius:12px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:16px}
    .task{background:#0e192a;border:2px solid #223046;border-radius:12px;padding:10px}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px}
    .modal .box{background:var(--card);border:1px solid #2a3849;border-radius:16px;max-width:520px;width:100%;padding:16px}

    @media (max-width:980px){
      .wrap{grid-template-columns:1fr}
      .board{width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 左：設定 / 控制 -->
    <div class="card" id="setupCard">
      <h1>哥哥弟弟大富翁</h1>
      <div class="hint">開局前請各自幫對方勾選球池內容。開始遊戲後即可輪流擲骰並抽任務；完成任務才能前進。</div>
      
      <h2>優勝者將可以獲得大秘寶!!!</h2>

      <!--<h2>抽卡方式</h2>-->
      <div class="row">
        <!--<label class="pill"><input type="radio" name="drawMode" value="self" checked> 由當前玩家從自己的兩個池抽（建議）</label>
        <label class="pill"><input type="radio" name="drawMode" value="mix"> 雙方各抽一個（實驗）</label> -->
      </div>

      <h2>弟弟的懲罰</h2>
      <div class="grid cols-2">
        <div>
          <div class="hint">勾選「教訓道具」</div>
          <div class="pool" id="broTools"></div>
        </div>
        <div>
          <div class="hint">勾選「懲罰數量」</div>
          <div class="pool" id="broCounts"></div>
        </div>
      </div>

      <h2>哥哥的愛護</h2>
      <div class="grid cols-2">
        <div>
          <div class="hint">勾選「互動行為」</div>
          <div class="pool" id="sisActs"></div>
        </div>
        <div>
          <div class="hint">勾選「親密部位」</div>
          <div class="pool" id="sisParts"></div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="green" id="startBtn">開始遊戲</button>
        <span class="hint">開始後仍可在暫停時調整設定。</span>
      </div>
    </div>

    <!-- 右：棋盤 + 控制 -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="row">
          <span class="pill"><span class="dot pA"></span> 哥哥</span>
          <span class="pill"><span class="dot pB"></span> 弟弟</span>
        </div>
        <div class="row">
          <button class="ghost" id="pauseBtn">暫停/設定</button>
          <button class="ghost" id="resetBtn">重置</button>
        </div>
      </div>

      <div class="board" id="board"></div>

      <div class="grid cols-2" style="margin-top:12px">
        <div class="card" style="background:#0f1626">
          <h2>回合控制</h2>
          <div class="row" style="margin:6px 0 8px">
            <div class="pill">目前：<b id="turnName">哥哥</b></div>
            <div class="pill">骰子：<b id="diceVal">—</b></div>
          </div>
          <div class="row">
            <button class="blue" id="rollA">哥哥擲骰 🎲</button>
            <button class="pink" id="rollB">弟弟擲骰 🎲</button>
            <button id="doneBtn" disabled>完成任務 ✅</button>
            <button id="failBtn" disabled>任務失敗 ❌</button> <!-- 新增按鈕 -->
          </div>
          <div class="task" id="taskBox">等待擲骰…</div>
        </div>
        <div>
          <h2 style="margin-top:0">事件紀錄</h2>
          <div class="log" id="log"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 勝利寶箱 -->
  <div class="modal" id="chestModal">
    <div class="box">
      <h2>🎁 懲罰寶箱(輸家乖乖受罰吧！)</h2>
      <div id="chestContent" class="grid"></div>
      <div class="row" style="margin-top:10px;justify-content:flex-end">
        <button class="green" id="closeChest">要上訴就點右上角"重置"</button>
      </div>
    </div>
  </div>

<script>
// ---------- 資料 ----------
const DATA = {
  bro: { // 弟弟：道具 + 數量
    tools: ["大板", "小板", "手掌", "皮帶", "棍子", "軟拍", "桌球拍", "戒尺"],
    counts: ["60", "50", "40", "30", "20"],
  },
  sis: { // 哥哥：互動 + 部位
    acts: ["按壓", "親吻", "舔舐", "撫摸", "輕拍"],
    parts: ["臉部", "胸部", "背部", "臀部", "肉棒", "肉穴"],
  },
};


// UI refs
const boardEl = document.getElementById('board');
const logEl = document.getElementById('log');
const taskBox = document.getElementById('taskBox');
const diceValEl = document.getElementById('diceVal');
const turnNameEl = document.getElementById('turnName');

const rollA = document.getElementById('rollA'); // 哥哥
const rollB = document.getElementById('rollB'); // 弟弟
const doneBtn = document.getElementById('doneBtn');
const failBtn = document.getElementById('failBtn');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const pauseBtn = document.getElementById('pauseBtn');

// Pools containers
const broToolsEl = document.getElementById('broTools');
const broCountsEl = document.getElementById('broCounts');
const sisActsEl = document.getElementById('sisActs');
const sisPartsEl = document.getElementById('sisParts');

const chestModal = document.getElementById('chestModal');
const chestContent = document.getElementById('chestContent');
const closeChest = document.getElementById('closeChest');

// State
let drawMode = 'self'; // self | mix
let started = false;
const players = [
  { name: '哥哥', pos: 0, key: 'sis' },
  { name: '弟弟', pos: 0, key: 'bro' },
];
let turn = 0; // 0: 哥哥, 1: 弟弟
let mustComplete = false;
let lastRoll = 0;

// ---------- 初始化 UI ----------
function makeCheckList(values, group, defaults = []){
  return values.map(v => {
    const id = `${group}-${v}`;
    const checked = defaults.includes(v) ? 'checked' : '';
    return `<label><input type="checkbox" data-group="${group}" value="${v}" ${checked}/> ${v}</label>`;
  }).join('');
}

function renderPools(){
  broToolsEl.innerHTML = makeCheckList(DATA.bro.tools, 'broTools', DATA.bro.tools.slice(0,5));
  broCountsEl.innerHTML = makeCheckList(DATA.bro.counts, 'broCounts', DATA.bro.counts);
  sisActsEl.innerHTML = makeCheckList(DATA.sis.acts, 'sisActs', DATA.sis.acts);
  sisPartsEl.innerHTML = makeCheckList(DATA.sis.parts, 'sisParts', DATA.sis.parts);
}

function getChecked(group){
  return Array.from(document.querySelectorAll(`input[data-group="${group}"]:checked`)).map(i=>i.value);
}

function $(sel){ return document.querySelector(sel); }

function log(msg){
  const time = new Date().toLocaleTimeString('zh-TW', { hour12:false });
  logEl.innerHTML = `[${time}] ${msg}<br>` + logEl.innerHTML;
}

function buildBoard(){
  boardEl.innerHTML = '';
  for(let i=1;i<=25;i++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.innerHTML = `<span class="idx">${i}</span>`;
    const token = document.createElement('div');
    token.className = 'token';
    if(i===1){
      token.innerHTML = `<span class="dot pA" title="哥哥"></span><span class="dot pB" title="弟弟"></span>`;
    }
    cell.appendChild(token);
    boardEl.appendChild(cell);
  }
}

function updateTokens(){
  // Clear tokens
  document.querySelectorAll('.cell .token').forEach(t=>t.innerHTML='');
  // Place tokens
  players.forEach((p,idx)=>{
    const cellIdx = Math.min(24, p.pos) + 1; // 0..24 -> 1..25; pos==24 => cell 25
    const tokenEl = boardEl.children[cellIdx-1].querySelector('.token');
    const span = document.createElement('span');
    span.className = 'dot ' + (idx===0? 'pA':'pB');
    span.title = p.name;
    tokenEl.appendChild(span);
  });
}


function setTurn(t){
  turn = t;
  turnNameEl.textContent = players[turn].name;
  rollA.disabled = turn!==0 || mustComplete || !started;
  rollB.disabled = turn!==1 || mustComplete || !started;
  doneBtn.disabled = !mustComplete;
  failBtn.disabled = !mustComplete; // 失敗按鈕同樣只在需要完成時可用
}

failBtn.addEventListener('click', failTask);

function randPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function currentPools(){
  const broTools = getChecked('broTools');
  const broCounts = getChecked('broCounts');
  const sisActs = getChecked('sisActs');
  const sisParts = getChecked('sisParts');
  return { broTools, broCounts, sisActs, sisParts };
}

function ensurePoolsOK(){
  const P = currentPools();
  const ok = P.broTools.length && P.broCounts.length && P.sisActs.length && P.sisParts.length;
  if(!ok){ alert('請至少在每個區塊勾選 1 項！'); }
  return ok;
}

function makeTaskText(rollerIdx, drawVal){
  const P = currentPools();
  const me = players[rollerIdx];
  const other = players[1-rollerIdx];

  let text = '';

  if(me.key==='bro'){ 
    // 弟弟：只用弟弟的道具+數量，不抽哥哥池
    const tool = randPick(P.broTools);
    const count = randPick(P.broCounts);
    text = `${other.name} 用「${tool}」對 ${me.name} 進行 ${count} 次教訓。`;
  } else { 
    // 哥哥：只用哥哥的互動+部位，不抽弟弟池
    const act = randPick(P.sisActs);
    const part = randPick(P.sisParts);
    let times = 1;
    if(["擊掌","握手"].includes(act)) times = Math.ceil(Math.random()*5);
    text = `${me.name} 對 ${other.name} 的「${part}」進行「${act}」${times} 次。`;
  }

  return text;
}


function rollDice(by){
  if(!started){ alert('請先開始遊戲'); return; }
  if(!ensurePoolsOK()) return;
  if(by!==turn) { alert('還沒輪到你喔'); return; }
  const val = Math.floor(Math.random()*6)+1;
  lastRoll = val; diceValEl.textContent = val;
  const task = makeTaskText(by, val);
  taskBox.textContent = '任務：' + task;
  log(`${players[by].name} 擲出 ${val} 點。`);
  mustComplete = true; setTurn(turn); // 鎖定需要完成
}

function completeTask(){
  if(!mustComplete) return;
  // 前進
  players[turn].pos = Math.min(24, players[turn].pos + lastRoll);
  updateTokens();
  log(`${players[turn].name} 完成任務，前進 ${lastRoll} 格（到達第 ${players[turn].pos+1} 格）。`);
  mustComplete = false; diceValEl.textContent = '—'; taskBox.textContent = '等待擲骰…';

  // 勝負
  if(players[turn].pos>=24){
    openChest(turn); // 本回合玩家抵達 25 勝利
  } else {
    setTurn(1-turn);
  }
}

function failTask(){
  if(!mustComplete) return;
  log(`${players[turn].name} 任務失敗，未前進。`);
  mustComplete = false; diceValEl.textContent = '—'; taskBox.textContent = '等待擲骰…';
  setTurn(1-turn);
}

function openChest(winnerIdx){
  const winner = players[winnerIdx];
  const loser = players[1-winnerIdx];
  const P = currentPools();
  chestContent.innerHTML = '';

  let rewards = [];
  if(loser.key==='bro'){
    // 若失敗者是弟弟：從「弟弟的道具+數量」生成 3 項，部位用哥哥的部位池
    for(let i=0;i<3;i++){
      const tool = randPick(P.broTools);
      const part = randPick(P.sisParts);
      rewards.push(`${winner.name} 用「${tool}」打 ${loser.name} ${part}`);
    }              
  }else{
    // 若失敗者是哥哥：從「哥哥的互動+部位」生成 3 項
    for(let i=0;i<3;i++){
      const act = randPick(P.sisActs);
      const count = randPick(P.broCounts);
      const part = randPick(P.sisParts);
      const times = Math.ceil(Math.random()*3);
      rewards.push(` ${loser.name} 要對${winner.name} 的${part} ${act} ${count} 次`);
    }
  }

  rewards.forEach(r=>{
    const div = document.createElement('div');
    div.className = 'task';
    div.textContent = '受罰項目：' + r + '。';
    chestContent.appendChild(div);
  });

  chestModal.style.display = 'flex';
  log(`🎉 ${winner.name} 抵達第 25 格，開啟寶箱！將對 ${loser.name} 執行 3 項懲罰。`);
}

closeChest.addEventListener('click', ()=>{
  chestModal.style.display = 'none';
});

// ---------- 控制 ----------
rollA.addEventListener('click', ()=>rollDice(0));
rollB.addEventListener('click', ()=>rollDice(1));

doneBtn.addEventListener('click', completeTask);

startBtn.addEventListener('click', ()=>{
  if(!ensurePoolsOK()) return;
  started = true; setTurn(0);
  $('#setupCard').style.opacity = .6; $('#setupCard').style.pointerEvents = 'none';
  log('遊戲開始！由 哥哥 先手。');
});

resetBtn.addEventListener('click', ()=>{
  players.forEach(p=>p.pos=0); updateTokens();
  mustComplete=false; setTurn(0); started=false; diceValEl.textContent='—'; taskBox.textContent='等待擲骰…';
  $('#setupCard').style.opacity = 1; $('#setupCard').style.pointerEvents = 'auto';
  buildBoard(); updateTokens(); log('已重置遊戲。');
});

pauseBtn.addEventListener('click', ()=>{
  const disabled = $('#setupCard').style.pointerEvents !== 'none';
  if(disabled){ // 正在可編輯 -> 改為不可編輯
    $('#setupCard').style.opacity = .6; $('#setupCard').style.pointerEvents = 'none';
  }else{
    $('#setupCard').style.opacity = 1; $('#setupCard').style.pointerEvents = 'auto';
  }
});

// 抽卡方式切換
Array.from(document.querySelectorAll('input[name="drawMode"]')).forEach(r=>{
  r.addEventListener('change', (e)=>{ drawMode = e.target.value; log('抽卡方式已切換為：' + (drawMode==='self'?'自己雙池':'雙方各一')); });
});

// 初始
renderPools();
buildBoard();
updateTokens();
setTurn(0);
</script>
</body>
</html>
